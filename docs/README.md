# ğŸ“– è‡ªåŠ¨å°è¯´ç”Ÿæˆå·¥å…·


<div align="center">
  
âœ¨ **æ ¸å¿ƒåŠŸèƒ½** âœ¨

| åŠŸèƒ½æ¨¡å—          | å…³é”®èƒ½åŠ›                          |
|-------------------|----------------------------------|
| ğŸ¨ å°è¯´è®¾å®šå·¥åŠ    | ä¸–ç•Œè§‚æ¶æ„ / è§’è‰²è®¾å®š / å‰§æƒ…è“å›¾   |
| ğŸ“– æ™ºèƒ½ç« èŠ‚ç”Ÿæˆ    | å¤šé˜¶æ®µç”Ÿæˆä¿éšœå‰§æƒ…è¿è´¯æ€§           |
| ğŸ§  çŠ¶æ€è¿½è¸ªç³»ç»Ÿ    | è§’è‰²å‘å±•è½¨è¿¹ / ä¼ç¬”ç®¡ç†ç³»ç»Ÿ         |
| ğŸ” è¯­ä¹‰æ£€ç´¢å¼•æ“    | åŸºäºå‘é‡çš„é•¿ç¨‹ä¸Šä¸‹æ–‡ä¸€è‡´æ€§ç»´æŠ¤      |
| ğŸ“š çŸ¥è¯†åº“é›†æˆ      | æ”¯æŒæœ¬åœ°æ–‡æ¡£å‚è€ƒ         |
| âœ… è‡ªåŠ¨å®¡æ ¡æœºåˆ¶    | æ£€æµ‹å‰§æƒ…çŸ›ç›¾ä¸é€»è¾‘å†²çª          |
| ğŸ–¥ å¯è§†åŒ–å·¥ä½œå°    | å…¨æµç¨‹ Web æ“ä½œï¼Œé…ç½®/ç”Ÿæˆ/å®¡æ ¡ä¸€ä½“åŒ– |

</div>

> ä¸€æ¬¾åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„å¤šåŠŸèƒ½å°è¯´ç”Ÿæˆå™¨ï¼ŒåŠ©æ‚¨é«˜æ•ˆåˆ›ä½œé€»è¾‘ä¸¥è°¨ã€è®¾å®šç»Ÿä¸€çš„é•¿ç¯‡æ•…äº‹

---

## ğŸ“‘ ç›®å½•å¯¼èˆª
1. [ç¯å¢ƒå‡†å¤‡](#-ç¯å¢ƒå‡†å¤‡)  
2. [é¡¹ç›®æ¶æ„](#-é¡¹ç›®æ¶æ„)  
3. [é…ç½®æŒ‡å—](#âš™ï¸-é…ç½®æŒ‡å—)  
4. [è¿è¡Œè¯´æ˜](#ğŸš€-è¿è¡Œè¯´æ˜)  
5. [ä½¿ç”¨æ•™ç¨‹](#ğŸ“˜-ä½¿ç”¨æ•™ç¨‹)  
6. [ç–‘éš¾è§£ç­”](#â“-ç–‘éš¾è§£ç­”)  

---

## ğŸ›  ç¯å¢ƒå‡†å¤‡
ç¡®ä¿æ»¡è¶³ä»¥ä¸‹è¿è¡Œæ¡ä»¶ï¼š
- **Python 3.9+** è¿è¡Œç¯å¢ƒï¼ˆæ¨è3.10-3.12ä¹‹é—´ï¼‰
- **uv** PythonåŒ…ç®¡ç†å·¥å…·
- **Node.js** 18+ ç¯å¢ƒï¼ˆç”¨äº Web UIï¼‰
- æœ‰æ•ˆAPIå¯†é’¥ï¼š
  - äº‘ç«¯æœåŠ¡ï¼šOpenAI / DeepSeek ç­‰
  - æœ¬åœ°æœåŠ¡ï¼šOllama ç­‰å…¼å®¹ OpenAI çš„æ¥å£

### å®‰è£… uv

#### Linux
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

#### Windows
```powershell
# PowerShell
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

#### é€šç”¨å®‰è£…æ–¹å¼
```bash
pip install uv
```

---

## ğŸ“¥ å®‰è£…è¯´æ˜

### 1. ä¸‹è½½é¡¹ç›®
é€šè¿‡ [GitHub](https://github.com) ä¸‹è½½é¡¹ç›® ZIP æ–‡ä»¶ï¼Œæˆ–ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å…‹éš†æœ¬é¡¹ç›®ï¼š
```bash
git clone https://github.com/abelxiaoxing/ai-novel-web
```

### 2. å®‰è£…ç¼–è¯‘å·¥å…·
éƒ¨åˆ† Python ä¾èµ–åŒ…éœ€è¦ç¼–è¯‘ï¼Œè¯·ç¡®ä¿ç³»ç»Ÿå·²å®‰è£…ç¼–è¯‘å·¥å…·ï¼š

#### Ubuntu
```bash
sudo apt-get update
sudo apt-get install -y build-essential python3-dev
```

#### Arch Linux
```bash
sudo pacman -S base-devel python
```

#### Windows
é€šå¸¸æ— éœ€é¢å¤–å·¥å…·ï¼Œå¦‚é‡é—®é¢˜è¯·å®‰è£… [Microsoft C++ Build Tools](https://visualstudio.microsoft.com/visual-cpp-build-tools/)

### 3. å®‰è£…ä¾èµ–å¹¶è¿è¡Œ

#### Linux

1. æ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥é¡¹ç›®ç›®å½•ï¼š
```bash
cd ai-novel-web
```

2. å®‰è£… Python ä¾èµ–ï¼š
```bash
uv sync
```

3. å®‰è£… Web UI ä¾èµ–ï¼š
```bash
npm --prefix webui install
```

4. å¯åŠ¨åç«¯æœåŠ¡ï¼š
```bash
uv run uvicorn backend.api_server:app --host 0.0.0.0 --port 8000
```

5. å¯åŠ¨ Web UIï¼ˆæ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼‰ï¼š
```bash
npm --prefix webui run dev
```

æˆ–ä½¿ç”¨ä¸€é”®å¯åŠ¨è„šæœ¬ï¼š
```bash
bash scripts/dev.sh
```

#### Windows

1. æ‰“å¼€ PowerShell æˆ–å‘½ä»¤æç¤ºç¬¦ï¼Œè¿›å…¥é¡¹ç›®ç›®å½•ï¼š
```powershell
cd ai-novel-web
```

2. å®‰è£… Python ä¾èµ–ï¼š
```powershell
uv sync
```

3. å®‰è£… Web UI ä¾èµ–ï¼š
```powershell
npm --prefix webui install
```

4. å¯åŠ¨åç«¯æœåŠ¡ï¼š
```powershell
uv run uvicorn backend.api_server:app --host 0.0.0.0 --port 8000
```

5. å¯åŠ¨ Web UIï¼ˆæ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼‰ï¼š
```powershell
npm --prefix webui run dev
```

> **ä¾èµ–è¡¥å……è¯´æ˜**  
> å¦‚æœå®‰è£…è¿‡ç¨‹ä¸­ç¼ºå¤±éƒ¨åˆ†ä¾èµ–ï¼Œå¯åç»­æ‰‹åŠ¨æ‰§è¡Œï¼š
> ```bash
> uv add XXX
> ```

## ğŸ—‚ é¡¹ç›®æ¶æ„
```
ai-novel-web/
â”œâ”€â”€ backend/                     # FastAPI æœåŠ¡
â”œâ”€â”€ consistency_checker.py       # ä¸€è‡´æ€§æ£€æŸ¥, é˜²æ­¢å‰§æƒ…å†²çª
|â€”â€” chapter_directory_parser.py  # ç›®å½•è§£æ
|â€”â€” embedding_adapters.py        # Embedding æ¥å£å°è£…
|â€”â€” llm_adapters.py              # LLM æ¥å£å°è£…
â”œâ”€â”€ prompt_definitions.py        # å®šä¹‰ AI æç¤ºè¯
â”œâ”€â”€ utils.py                     # å¸¸ç”¨å·¥å…·å‡½æ•°, æ–‡ä»¶æ“ä½œ
â”œâ”€â”€ config_manager.py            # ç®¡ç†é…ç½® (API Key, Base URL)
â”œâ”€â”€ config.example.json          # é…ç½®æ¨¡æ¿ï¼ˆä¸å«å¯†é’¥ï¼‰
â”œâ”€â”€ novel_generator/             # ç« èŠ‚ç”Ÿæˆæ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ webui/                       # Web å‰ç«¯
â””â”€â”€ vectorstore/                 # (å¯é€‰) æœ¬åœ°å‘é‡æ•°æ®åº“å­˜å‚¨
```

---

## âš™ï¸ é…ç½®æŒ‡å—
### ğŸ“Œ é…ç½®ä½ç½®ï¼ˆåˆ†å±‚åŠ è½½ï¼‰
1. **æ¨¡æ¿**ï¼šä»“åº“å†… `config.example.json`
2. **æœ¬åœ°é…ç½®**ï¼šé»˜è®¤ `~/.config/.ai_novel_web/config.json`
3. **ç¯å¢ƒå˜é‡è¦†ç›–**ï¼šè¿è¡Œæ—¶åˆå¹¶ï¼Œä¸å†™å›é…ç½®æ–‡ä»¶

> å¯ç”¨ `AINOVEL_CONFIG_FILE` æŒ‡å®šæœ¬åœ°é…ç½®è·¯å¾„ã€‚

### ğŸ”§ é…ç½®ç»“æ„ï¼ˆç¤ºæ„ï¼‰
```json
{
  "llm_configs": {
    "my_llm": {
      "api_key": "",
      "base_url": "https://api.openai.com/v1",
      "model_name": "gpt-4o-mini",
      "temperature": 0.7,
      "max_tokens": 4096,
      "timeout": 900,
      "interface_format": "OpenAI"
    }
  },
  "embedding_configs": {
    "my_embedding": {
      "api_key": "",
      "base_url": "https://api.openai.com/v1",
      "model_name": "text-embedding-3-small",
      "retrieval_k": 4,
      "interface_format": "OpenAI"
    }
  },
  "choose_configs": {
    "architecture_llm": "my_llm",
    "chapter_outline_llm": "my_llm",
    "prompt_draft_llm": "my_llm",
    "final_chapter_llm": "my_llm",
    "consistency_llm": "my_llm"
  }
}
```

### ğŸ” ç¯å¢ƒå˜é‡è¦†ç›–ï¼ˆå¸¸ç”¨ï¼‰
- `AINOVEL_LLM_API_KEY`ï¼šå¡«å……æ‰€æœ‰ LLM é…ç½®çš„ `api_key`ï¼ˆä»…åœ¨ä¸ºç©ºæ—¶ï¼‰
- `AINOVEL_EMBEDDING_API_KEY`ï¼šå¡«å……æ‰€æœ‰ Embedding é…ç½®çš„ `api_key`ï¼ˆä»…åœ¨ä¸ºç©ºæ—¶ï¼‰
- `AINOVEL_CONFIG_OVERRIDES`ï¼šJSON å­—ç¬¦ä¸²ï¼Œæ·±åº¦åˆå¹¶åˆ°é…ç½®ä¸­

---

## ğŸš€ è¿è¡Œè¯´æ˜

### Linux

**æ–¹å¼ 1ï¼šæ‰‹åŠ¨å¯åŠ¨**
```bash
# ç»ˆç«¯ 1 - å¯åŠ¨åç«¯
uv run uvicorn backend.api_server:app --host 0.0.0.0 --port 8000

# ç»ˆç«¯ 2 - å¯åŠ¨å‰ç«¯
npm --prefix webui run dev -- --host 0.0.0.0
```

**æ–¹å¼ 2ï¼šä¸€é”®å¯åŠ¨**
```bash
bash scripts/dev.sh
```

### Windows

**æ–¹å¼ 1ï¼šæ‰‹åŠ¨å¯åŠ¨**
```powershell
# ç»ˆç«¯ 1 - å¯åŠ¨åç«¯
uv run uvicorn backend.api_server:app --host 0.0.0.0 --port 8000

# ç»ˆç«¯ 2 - å¯åŠ¨å‰ç«¯
npm --prefix webui run dev -- --host 0.0.0.0
```

**æ–¹å¼ 2ï¼šä¸€é”®å¯åŠ¨**
```powershell
# åœ¨PowerShellä¸­è¿è¡Œ
bash scripts/dev.sh
```

å¯åŠ¨ååœ¨æµè§ˆå™¨æ‰“å¼€ `http://localhost:5173` å³å¯è®¿é—® Web å·¥ä½œå°ã€‚

### ğŸŒ å±€åŸŸç½‘è®¿é—®

æœ¬é¡¹ç›®å·²é…ç½®æ”¯æŒå±€åŸŸç½‘è®¿é—®ï¼š

1. **åç«¯ API**ï¼šé»˜è®¤ç›‘å¬ `0.0.0.0:8000`ï¼Œå±€åŸŸç½‘å†…å…¶ä»–è®¾å¤‡å¯é€šè¿‡ `http://<æœåŠ¡å™¨IP>:8000` è®¿é—®
2. **å‰ç«¯ Web UI**ï¼šé»˜è®¤ç›‘å¬ `0.0.0.0:5173`ï¼Œå±€åŸŸç½‘å†…å…¶ä»–è®¾å¤‡å¯é€šè¿‡ `http://<æœåŠ¡å™¨IP>:5173` è®¿é—®
3. **CORS é…ç½®**ï¼šå·²å…è®¸æ‰€æœ‰æ¥æºè·¨åŸŸè®¿é—®ï¼Œæ”¯æŒå±€åŸŸç½‘å†…è®¾å¤‡è°ƒç”¨ API

**æŸ¥çœ‹æœåŠ¡å™¨IP**ï¼š
- Linux: `ip addr` æˆ– `ifconfig`
- Windows: `ipconfig`

**ç¤ºä¾‹è®¿é—®åœ°å€**ï¼š
- æœ¬åœ°è®¿é—®ï¼š`http://localhost:5173`
- å±€åŸŸç½‘è®¿é—®ï¼š`http://192.168.x.x:5173`ï¼ˆæ›¿æ¢ä¸ºå®é™…æœåŠ¡å™¨IPï¼‰

---

## ğŸ“˜ ä½¿ç”¨æ•™ç¨‹
1. **å¯åŠ¨åï¼Œå…ˆå®ŒæˆåŸºæœ¬å‚æ•°è®¾ç½®ï¼š**  
   - **API Key & Base URL**ï¼ˆå¦‚ `https://api.openai.com/v1`ï¼‰  
   - **æ¨¡å‹åç§°**ï¼ˆå¦‚ `gpt-3.5-turbo`ã€`gpt-4o` ç­‰ï¼‰  
   - **Temperature** (0~1ï¼Œå†³å®šæ–‡å­—åˆ›æ„ç¨‹åº¦)  
   - **ä¸»é¢˜(Topic)**ï¼ˆå¦‚ â€œåºŸåœŸä¸–ç•Œçš„ AI å›ä¹±â€ï¼‰  
   - **ç±»å‹(Genre)**ï¼ˆå¦‚ â€œç§‘å¹»â€/â€œé­”å¹»â€/â€œéƒ½å¸‚å¹»æƒ³â€ï¼‰  
   - **ç« èŠ‚æ•°**ã€**æ¯ç« å­—æ•°**ï¼ˆå¦‚ 10 ç« ï¼Œæ¯ç« çº¦ 3000 å­—ï¼‰  
   - **ä¿å­˜è·¯å¾„**ï¼ˆå»ºè®®åˆ›å»ºä¸€ä¸ªæ–°çš„è¾“å‡ºæ–‡ä»¶å¤¹ï¼‰

2. **ç‚¹å‡»ã€ŒStep1. ç”Ÿæˆè®¾å®šã€**  
   - ç³»ç»Ÿå°†åŸºäºä¸»é¢˜ã€ç±»å‹ã€ç« èŠ‚æ•°ç­‰ä¿¡æ¯ï¼Œç”Ÿæˆï¼š  
     - `Novel_architecture.txt`ï¼šåŒ…å«ä¸–ç•Œè§‚ã€è§’è‰²ä¿¡æ¯ã€é›·ç‚¹æš—çº¿ç­‰ã€‚  
   - å¯ä»¥åœ¨ç”Ÿæˆåçš„ `Novel_architecture.txt` ä¸­æŸ¥çœ‹æˆ–ä¿®æ”¹è®¾å®šå†…å®¹ã€‚

3. **ç‚¹å‡»ã€ŒStep2. ç”Ÿæˆç›®å½•ã€**  
   - ç³»ç»Ÿä¼šæ ¹æ®å·²å®Œæˆçš„ `Novel_architecture.txt` å†…å®¹ï¼Œä¸ºå…¨éƒ¨ç« èŠ‚ç”Ÿæˆï¼š  
     - `Novel_directory.txt`ï¼šåŒ…æ‹¬æ¯ç« æ ‡é¢˜å’Œç®€è¦æç¤ºã€‚  
   - å¯ä»¥åœ¨ç”Ÿæˆåçš„æ–‡ä»¶ä¸­æŸ¥çœ‹ã€ä¿®æ”¹æˆ–è¡¥å……ç« èŠ‚æ ‡é¢˜å’Œæè¿°ã€‚

4. **ç‚¹å‡»ã€ŒStep3. ç”Ÿæˆç« èŠ‚è‰ç¨¿ã€**  
   - åœ¨ç”Ÿæˆç« èŠ‚ä¹‹å‰ï¼Œä½ å¯ä»¥ï¼š  
     - **è®¾ç½®ç« èŠ‚å·**ï¼ˆå¦‚å†™ç¬¬ 1 ç« ï¼Œå°±å¡« `1`ï¼‰  
     - **åœ¨â€œæœ¬ç« æŒ‡å¯¼â€è¾“å…¥æ¡†**ä¸­æä¾›å¯¹æœ¬ç« å‰§æƒ…çš„ä»»ä½•æœŸæœ›æˆ–æç¤º  
   - ç‚¹å‡»æŒ‰é’®åï¼Œç³»ç»Ÿå°†ï¼š  
     - è‡ªåŠ¨è¯»å–å‰æ–‡è®¾å®šã€`Novel_directory.txt`ã€ä»¥åŠå·²å®šç¨¿ç« èŠ‚  
     - è°ƒç”¨å‘é‡æ£€ç´¢å›é¡¾å‰§æƒ…ï¼Œä¿è¯ä¸Šä¸‹æ–‡è¿è´¯  
     - ç”Ÿæˆæœ¬ç« æ­£æ–‡ (`chapter_X.txt`)  
   - ç”Ÿæˆå®Œæˆåï¼Œä½ å¯åœ¨å·¦ä¾§çš„æ–‡æœ¬æ¡†æŸ¥çœ‹ã€ç¼–è¾‘æœ¬ç« è‰ç¨¿å†…å®¹ã€‚

5. **ç‚¹å‡»ã€ŒStep4. å®šç¨¿å½“å‰ç« èŠ‚ã€**  
   - ç³»ç»Ÿå°†ï¼š  
     - **æ›´æ–°å…¨å±€æ‘˜è¦**ï¼ˆå†™å…¥ `global_summary.txt`ï¼‰  
     - **æ›´æ–°è§’è‰²çŠ¶æ€**ï¼ˆå†™å…¥ `character_state.txt`ï¼‰  
     - **æ›´æ–°å‘é‡æ£€ç´¢åº“**ï¼ˆä¿è¯åç»­ç« èŠ‚å¯ä»¥è°ƒç”¨æœ€æ–°ä¿¡æ¯ï¼‰  
     - **å‰§æƒ…è¦ç‚¹** (`plot_arcs.txt`) éœ€æ‰‹åŠ¨ç»´æŠ¤ï¼Œç”¨äºä¸€è‡´æ€§æ£€æŸ¥å‚è€ƒ  
   - å®šç¨¿å®Œæˆåï¼Œä½ å¯ä»¥åœ¨ `chapter_X.txt` ä¸­çœ‹åˆ°å®šç¨¿åçš„æ–‡æœ¬ã€‚

6. **ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰**  
   - ç‚¹å‡»ã€Œ[å¯é€‰] ä¸€è‡´æ€§å®¡æ ¡ã€æŒ‰é’®ï¼Œå¯¹æœ€æ–°ç« èŠ‚è¿›è¡Œå†²çªæ£€æµ‹ï¼Œå¦‚è§’è‰²é€»è¾‘ã€å‰§æƒ…å‰åçŸ›ç›¾ç­‰ã€‚  
   - è‹¥æœ‰å†²çªï¼Œä¼šåœ¨æ—¥å¿—åŒºè¾“å‡ºè¯¦ç»†æç¤ºã€‚

7. **é‡å¤ç¬¬ 4-6 æ­¥** ç›´åˆ°æ‰€æœ‰ç« èŠ‚ç”Ÿæˆå¹¶å®šç¨¿ï¼

> **å‘é‡æ£€ç´¢é…ç½®æç¤º**
> 1. embeddingæ¨¡å‹éœ€è¦æ˜¾ç¤ºæŒ‡å®šæ¥å£å’Œæ¨¡å‹åç§°
> 2. ä½¿ç”¨**æœ¬åœ°Ollama**çš„**Embedding**æ—¶éœ€æå‰å¯åŠ¨OllamaæœåŠ¡ï¼š
>
>    ** Linux:**
>    ```bash
>    ollama serve  # å¯åŠ¨æœåŠ¡
>    ollama pull nomic-embed-text  # ä¸‹è½½/å¯ç”¨æ¨¡å‹
>    ```
>
>    **Windows:**
>    ```powershell
>    ollama serve  # å¯åŠ¨æœåŠ¡
>    ollama pull nomic-embed-text  # ä¸‹è½½/å¯ç”¨æ¨¡å‹
>    ```
>
> 3. åˆ‡æ¢ä¸åŒEmbeddingæ¨¡å‹åå»ºè®®æ¸…ç©ºvectorstoreç›®å½•
> 4. äº‘ç«¯Embeddingéœ€ç¡®ä¿å¯¹åº”APIæƒé™å·²å¼€é€š

